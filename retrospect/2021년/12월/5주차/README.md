# (기술) 네이티브 프로그래밍과 `node-gyp`

`Electron.js`는 `Windows OS`와 `Mac OS`를 동시에 개발 할 수 있는 `Node.js`의 크로스 플랫폼 데스크탑 앱 개발 프레임워크이다.  
크로스 플랫폼이고, 두 `OS`를 동시에 개발하는 통합 언어를 사용하다 보니, 각기 `OS`에서만 동작하는 기능과 같은 깊은 개발에는 관여하기 힘든 문제가 있다.

그렇다면 `Electron.js`를 사용하면 네이티브 개발을 못하므로 프로그래밍에 한계가 있을까?

아니다. `Electron.js`도, `Node.js`도 결국 어셈블리어로 변환이 되어 컴퓨터에서 실행이 될 수 있으며, 더군다나 `Node.js`가 `C/C++`을 통해 구현이 된 프레임워크이기 때문에 어떻게든 그 아래 영역에 접근하여 `C/C++` 코드. 즉, 네이티브 프레임워크(`WIN32 API`, `Cocoa Framework`)를 사용하는 코드만 집어넣을 수 있다면 네이티브 개발을 할 수 있게 된다.

> 그래서 `node-gyp`라는 `C/C++`을 연결해주는 라이브러리를 조사하였다.

## `node-gyp`

`node-gyp`를 알게된 이유는 다른 라이브러리를 사용하면서였다.  
지금 사용 중인 `npm module` 중 `USB Serial` 통신을 할 수 있게 해주는 `serialport`, 키와 마우스를 제어할 수 있게 해주는 `robotjs`, `USB`의 연결/해제을 감지하는 `usb-detection`, 그리고 다른 애플리케이션 윈도우(창)을 관리할 수 있는 `node-window-manager`는 모두 네이티브 기능을 수행하는데 `JavaScript`로 개발이 되어있지 않음을 확인했다.

위 라이브러리들은 모두 `filename.node`라는 형식의 이진 파일을 불러와 사용하고 있었고, 이진 파일을 `node-gyp`라는 라이브러리를 통해 빌드된다는 사실을 알게 됐다.

이 사실은 `JavaScript`로 이진 파일로 만들어진 파일을 `JavaScript module` 처럼 사용하는 것이 가능하다는 것을 알게 해주었고, 곧 `Node.js`의 확장성이 무궁무진하다는 결론으로 인도해주었다.

`node-gyp`는 `Node.js`용 기본 `addon` 모듈을 컴파일 하기 위해 `Node.js`로 작성된 크로스 플랫폼 커맨드 라인 도구이다. 이 도구를 사용하면 `Node.js`의 버전에 관계 없이 사용 가능한 모듈을 빌드할 수 있고, 이를 통해 `C`, `C++` 소스 코드를 컴파일하여 `Node.js`에서 사용할 수 있다.

그리고 `Node.js` 또한 `C`, `C++`로 작성된 `addon` 모듈을 통해 구현되어 있으며, 이렇게 구현된 엔진을 `V8` 엔진이라고 부른다는 정보를 알게 됐다. 즉, `Node.js`는 `C`와 `C++`로 작성된 `addon` 모듈의 결정체였다. 그렇기 때문에 `Node.js`에서 `addon`을 불러오는 것은 전혀 문제가 없게 된다.

이 사실은 지금까지 `Node.js`가 브라우저 환경이 아닌 데스크탑 환경에서 동작하는 `JavaScript` 런타임일 뿐이고, 서버 개발 언어로 많이 활용하고 있다는 편견을 깼다.

- [`node-gyp` 문서](https://github.com/nodejs/node-gyp/tree/2ef5fb86277c4d81baffc0b9f642a8d86be1bfa5/docs)

## `addon`

`node-gyp`에서 지속적으로 언급되는 `addon`은 `C++`로 작성된 동적으로 연결된 공유 객체이다. `JavaScript`와 `C/C++` 라이브러리 간의 인터페이스. 즉, 두 언어의 연결을 제공해주는 역할을 한다.
`C/C++`로 작성된 소스를 `Node.js`에서 사용할 수 있도록 만들어주는 방법이라고 생각하면 될 것 같다. `addon` 작성법을 통해 네이티브 개발 소스 코드를 `Node.js`로 넘겨줄 수 있고, `addon`에 어떠한 `C/C++` 라이브러리를 사용할지 결정하여 `addon` 빌드 파일을 작성하고, `addon` 빌드 파일을 컴파일 할 수 있는 환경을 `node-gyp`로 구축하고 빌드하는 것이다.

이는 당장에 보기에도 이해하기 어려운 방식이다. 문서를 직접 보더라도 잘 응용하려면 연구 및 실험이 병행되어야 한다. 또한 `addon`과 `node-gyp`를 숙지하더라도 기본적으로 `C`와 `C++`에 언어 이해도가 기반이 되어야 하며, 그 이후에 `WIN32 API`와 `Objective-C`, `Cocoa Framework` 또한 능숙하게 다룰 수 있어야 한다. 하지만 기존 서버 언어로 사용됐던 `Node.js`를 더더욱 매력적인 개발 도구로 사용하기 위해선 이 `node-gyp`를 통한 `addon` 개발 능력이 중요할 것으로 예상된다.

- [`Node.js addons` 문서](https://nodejs.org/api/addons.html)

## 이를 적용하면?

이 매력적인 개발 도구를 잘 적용하면 기존에는 외부 라이브러리에 의존했던 기능들을 모두 작성, 구현할 수 있게 된다. 이는 외부 라이브러리의 의존성을 줄일 수 있다는 점에서 애플리케이션의 안정화를 가져올 수 있으며, 외부 라이브러리에서 지원하지 않는 기능 또한 추가로 개발할 수 있게 된다.

또한 개발한 네이티브 `addon` 소스 코드를 `npm`에 업로드 할 기회가 생기게 되어 개발 능력, 경험 향상에 큰 도움이 된다.

당장에 상기 기술했던 `serialport`, `robotjs`, `usb-detection`, `node-window-manager`와 같은 라이브러리에서 제대로 지원하지 않는 한/영 키 인식 및 전환 기능, 다른 창에 직접 접근하여 강제 단축키 입력이 아닌 값을 넘겨주는 기능, `Windows OS`에서 스크롤이 정상적으로 동작하지 않는 현상, 다이얼을 통해 드래그를 이용할 수 있는 기능, `Shift` 및 `Control` 등의 특수 키를 독립적으로 사용할 수 없는 기능, `Windows OS`에서 아이콘이 제대로 로드되지 않는 버그 등을 해결 및 구현할 수 있게 된다.

> `node-gyp`의 활용은 자사의 성장을 촉진함과 동시에 개발자 스스로도 성장할 수 있는 역할을 할 수 있으리라 생각되어 이를 더 깊게 탐구하는 것에 대해 욕심이 생겼다.
